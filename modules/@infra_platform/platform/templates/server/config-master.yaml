apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "platform.fullname" . }}--server-config-master--cfmp
  namespace: {{ .Release.Namespace }}
  labels:
    name: {{ include "platform.fullname" . }}--server-config-master--cfmp
    chart: {{ .Chart.Name }}
data:
  production.env: |-
    NODE_ENV=production
    API_PORT=3000
    MASTER=true

    CASSANDRA_CONTACT_POINTS={{ required "[server] Missing config.cassandra.host value" .Values.config.cassandra.host }}
    CASSANDRA_PORT={{ required "[server] Missing config.cassandra.port value" .Values.config.cassandra.port }}

    VALIDATION_URL={{ required "[server] Missing config.redirections.emailValidationUrl value" .Values.config.redirections.emailValidationUrl }}
    RESET_PASSWORD_URL={{ required "[server] Missing config.redirections.passwordResetUrl value" .Values.config.redirections.passwordResetUrl }}

    ELASTICSEARCH_HOST={{ required "[server] Missing config.elasticsearch.host value" .Values.config.elasticsearch.host }}
    ELASTICSEARCH_PORT={{ required "[server] Missing config.elasticsearch.port value" .Values.config.elasticsearch.port }}
    ELASTICSEARCH_PROTOCOL={{ required "[server] Missing config.elasticsearch.protocol value" .Values.config.elasticsearch.protocol }}

    BCRYPT_SALT_ROUNDS={{ required "[server] Missing config.jwt.rounds value" .Values.config.jwt.rounds }}
    JWT_EXPIRATION={{ required "[server] Missing config.jwt.expiration value" .Values.config.jwt.expiration }}

    AUTH_SIGNATURE_TIMEOUT=30000

    EMAIL_ENGINE=mailjet

    EMAIL_TEMPLATE_PATH=../@backend_email-templates

    IMAGE_MAX_SIZE=5
    IMAGE_S3_REGION={{ required "[server] Missing config.s3.region value" .Values.config.s3.region }}
    IMAGE_S3_ACCESS_KEY_ID={{ required "[server] Missing config.s3.accessKeyId value" .Values.config.s3.accessKeyId }}
    IMAGE_S3_SECRET_ACCESS_KEY={{ required "[server] Missing config.s3.secretAccessKey value" .Values.config.s3.secretAccessKey }}
    IMAGE_S3_BUCKET_NAME={{ required "[server] Missing config.s3.bucketName value" .Values.config.s3.bucketName }}

    FEATURE_FLAGS_CONFIG=/config/feature-flags.json
