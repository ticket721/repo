settings:
  kubeContext: "${CONTEXT}"
  reverseDelete: true

helmRepos:
  stable: https://kubernetes-charts.storage.googleapis.com
  common: https://kubernetes-charts-incubator.storage.googleapis.com/
  incubator: https://kubernetes-charts-incubator.storage.googleapis.com/
  jetstack: https://charts.jetstack.io

namespaces:
  staging:
  monitoring:
  default:

apps:

#   ██████  ███████ ███████  █████  ██    ██ ██   ████████ 
#   ██   ██ ██      ██      ██   ██ ██    ██ ██      ██    
#   ██   ██ █████   █████   ███████ ██    ██ ██      ██ 
#   ██   ██ ██      ██      ██   ██ ██    ██ ██      ██ 
#   ██████  ███████ ██      ██   ██  ██████  ███████ ██ 

  crds:
    timeout: 1200
    name: "crds"
    description: "CRDs, collection of custom ressource definitions to install globally"
    namespace: "default"
    enabled: true
    group: "critical"
    chart: "../@infra_crds/crds"
    version: "0.1.0"
    valuesFile: "../@infra_crds/crds/values.yaml"
    protected: false
    wait: true
    priority: -9
    setString:
      _global.namespace: "default"

  cert-manager:
    timeout: 1200
    name: "cert-manager"
    description: "Certifacte Manager, able to create valid certificates on-demand"
    namespace: "default"
    enabled: true
    group: "critical"
    chart: "../@infra_cert-manager/cert-manager"
    version: "0.1.0"
    valuesFile: "../@infra_cert-manager/cert-manager/values.yaml"
    protected: false
    wait: true
    priority: -8
    setString:
      _global.namespace: "default"
      route53.keySecret: "${CONFIG_STAGING_ROUTE53_SECRET}"

#   ███    ███  ██████  ███    ██ ██ ████████  ██████  ██████  ██ ███    ██  ██████ 
#   ████  ████ ██    ██ ████   ██ ██    ██    ██    ██ ██   ██ ██ ████   ██ ██      
#   ██ ████ ██ ██    ██ ██ ██  ██ ██    ██    ██    ██ ██████  ██ ██ ██  ██ ██   ███ 
#   ██  ██  ██ ██    ██ ██  ██ ██ ██    ██    ██    ██ ██   ██ ██ ██  ██ ██ ██    ██ 
#   ██      ██  ██████  ██   ████ ██    ██     ██████  ██   ██ ██ ██   ████  ██████  

  ingress-monitoring:
    timeout: 1200
    name: "ingress-monitoring"
    description: "Ingress, managing all incoming traffic and properly redirecting on services for the monitoring namespace"
    namespace: "monitoring"
    enabled: true
    group: "critical"
    chart: "../@infra_ingress/ingress"
    version: "0.1.0"
    valuesFile: "../@infra_ingress/ingress/values.yaml"
    protected: false
    wait: true
    priority: 0
    setString:
      _global.namespace: "monitoring"

      issuer.server: "${CONFIG_STAGING_ACME_SERVER}"

      baseDomain: "ticket721.com"
      domainExtension: "monitoring"

      hosts[0].name: "grafana.monitoring.ticket721.com"
      hosts[0].paths[0].route: "/"
      hosts[0].paths[0].serviceName: "prometheus-monitoring-grafana"
      hosts[0].paths[0].servicePort: "80"

      route53.keyId: "${CONFIG_STAGING_ROUTE53_KEY}"
      route53.hostedzone: "${CONFIG_STAGING_ROUTE53_HOSTEDZONE}"
      route53.region: "eu-west-3"

  prometheus-monitoring:
    timeout: 1200
    name: "prometheus-monitoring"
    description: "Prometheus gathers metrics about the cluster"
    namespace: "monitoring"
    enabled: true
    group: "critical"
    chart: "../@infra_prometheus/prometheus"
    version: "0.1.0"
    valuesFile: "../@infra_prometheus/prometheus/values.yaml"
    protected: false
    wait: true
    priority: -1
    setString:
      _global.namespace: "monitoring"

#   ███████ ████████  █████   ██████  ██ ███    ██  ██████ 
#   ██         ██    ██   ██ ██       ██ ████   ██ ██      
#   ███████    ██    ███████ ██   ███ ██ ██ ██  ██ ██   ███ 
#        ██    ██    ██   ██ ██    ██ ██ ██  ██ ██ ██    ██ 
#   ███████    ██    ██   ██  ██████  ██ ██   ████  ██████  

  ingress-staging:
    timeout: 1200
    name: "ingress-staging"
    description: "Ingress, managing all incoming traffic and properly redirecting on services for the staging namespace"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_ingress/ingress"
    version: "0.1.0"
    valuesFile: "../@infra_ingress/ingress/values.yaml"
    protected: false
    wait: true
    priority: 0
    setString:
      _global.namespace: "staging"

      issuer.server: "${CONFIG_STAGING_ACME_SERVER}"

      baseDomain: "ticket721.com"
      domainExtension: "staging"

      hosts[0].name: "api.staging.ticket721.com"
      hosts[0].paths[0].route: "/"
      hosts[0].paths[0].serviceName: "platform-staging--server--svc"
      hosts[0].paths[0].servicePort: "80"

      hosts[1].name: "organizer.staging.ticket721.com"
      hosts[1].paths[0].route: "/"
      hosts[1].paths[0].serviceName: "platform-staging--organizer--svc"
      hosts[1].paths[0].servicePort: "80"

      hosts[2].name: "app.staging.ticket721.com"
      hosts[2].paths[0].route: "/"
      hosts[2].paths[0].serviceName: "platform-staging--t721app--svc"
      hosts[2].paths[0].servicePort: "80"

      route53.keyId: "${CONFIG_STAGING_ROUTE53_KEY}"
      route53.hostedzone: "${CONFIG_STAGING_ROUTE53_HOSTEDZONE}"
      route53.region: "eu-west-3"

  efs-provisioner-staging:
    timeout: 1200
    name: "efs-provisioner-staging"
    description: "EFS Storage Provider, allowing pods to mount EFS volumes in the filesystem"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_efs-provisioner/efs-provisioner"
    version: "0.1.0"
    valuesFile: "../@infra_efs-provisioner/efs-provisioner/values.yaml"
    protected: false
    wait: true
    priority: -4
    setString:
      _global.namespace: "staging"
      "efs-provisioner.efsProvisioner.efsFileSystemId": "${CONFIG_STAGING_EFS_ID}"
      "efs-provisioner.efsProvisioner.awsRegion": "eu-west-3"

  elassandra-staging:
    timeout: 1200
    name: "elassandra-staging"
    description: "Elassandra, storage layer of the infrastructure"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_elassandra/elassandra"
    version: "1.0.0"
    valuesFile: "../@infra_elassandra/elassandra/values.yaml"
    protected: false
    wait: true
    priority: -3
    setString:
      _global.namespace: "staging"

  redis-staging:
    timeout: 1200
    name: "redis-staging"
    description: "Redis, Storage layer for the distributed tasks"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_redis/redis"
    version: "0.1.0"
    valuesFile: "../@infra_redis/redis/values.yaml"
    protected: false
    wait: true
    priority: -2
    setString:
      _global.namespace: "staging"

  platform-staging:
    timeout: 2400
    name: "platform-staging"
    description: "The Ticket721 Platform"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_platform/platform"
    version: "0.1.0"
    valuesFile: "../@infra_platform/platform/values.yaml"
    protected: false
    wait: true
    priority: -1
    setString:
      _global.namespace: "staging"

      server.fsName: "${CONFIG_STAGING_EFS_ID}"

      config.ticketScope: "ticket721_0"
      config.artifact: "live_ropsten"

      config.stripe.apiKey: "${CONFIG_STAGING_STRIPE_APIKEY}"

      config.cassandra.host: "elassandra-staging-cassandra"
      config.cassandra.port: "9042"

      config.redirections.emailValidationUrl: "https://organizer.staging.ticket721.com/validate-email"
      config.redirections.passwordResetUrl: "https://organizer.staging.ticket721.com/validate/password/reset"

      config.elasticsearch.host: "elassandra-staging-elasticsearch"
      config.elasticsearch.port: "9200"
      config.elasticsearch.protocol: "http"

      config.ethereumNode.host: "api.rockside.io"
      config.ethereumNode.port: "443"
      config.ethereumNode.protocol: "https"
      config.ethereumNode.network_id: "3"
      config.ethereumNode.path: "/ethereum/ropsten/jsonrpc"
      config.ethereumNode.headers: '\{"apikey": "${CONFIG_STAGING_ROCKSIDE_APIKEY}"\}'

      config.redis.host: "redis-staging-master"
      config.redis.port: "6379"

      config.jwt.rounds: "9"
      config.jwt.secret: "${CONFIG_STAGING_JWT_SECRET}"
      config.jwt.expiration: "12h"

      config.txs.blockThreshold: "0"
      config.txs.blockPollingRate: "1000"
      config.txs.targetGasPrice: "15"
      config.txs.gasLimit: "1000000"

      config.globalConfig.blockNumberFetchingRate: "1000"
      config.globalConfig.ethereumPriceFetchingRate: "1000"
      config.globalConfig.binanceMock: "false"

      config.bull.board: "true"

      config.mailjet.apiKey: "${CONFIG_STAGING_MAILJET_APIKEY}"
      config.mailjet.apiSecret: "${CONFIG_STAGING_MAILJET_APISECRET}"

      config.rockside.baseUrl: "https://api.rockside.io"
      config.rockside.apiKey: "${CONFIG_STAGING_ROCKSIDE_APIKEY}"
      config.rockside.network_id: "3"
      config.rockside.network_name: "ropsten"

      config.googleGeocodingApiKey: "${CONFIG_STAGING_GCLOUD_GEOLOC_APIKEY}"
      config.serverEndpoint.host: "api.staging.ticket721.com"
      config.serverEndpoint.port: "443"
      config.serverEndpoint.protocol: "https"

      config.frontEthereumNode.url: "https://api.rockside.io/ethereum/ropsten/jsonrpc"
      config.frontEthereumNode.networkId: "3"
      config.organizer.frontEthereumNodeHeaders: '\{\\"Authorization\\": \\"Bearer ${CONFIG_STAGING_ORGANIZER_ROCKSIDE_TOKEN}\\"\}'
      config.t721app.frontEthereumNodeHeaders: '\{\\"Authorization\\": \\"Bearer ${CONFIG_STAGING_T721APP_ROCKSIDE_TOKEN}\\"\}'

      config.organizer.segmentApiKey: "${CONFIG_STAGING_ORGANIZER_SEGMENT_API_KEY}"
      config.t721app.segmentApiKey: "${CONFIG_STAGING_T721APP_SEGMENT_API_KEY}"
      config.t721app.publishableStripeApiKey: "${CONFIG_STAGING_T721APP_PUBLISHABLE_STRIPE_API_KEY}"
      config.etherscanUrl: "${CONFIG_STAGING_ETHERSCAN_URL}"

      server.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/server"
      server.image.tag: "${TAG}"

      worker.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/worker"
      worker.image.tag: "${TAG}"

      migrations.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/migrations"
      migrations.image.tag: "${TAG}"

      organizer.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/organizer"
      organizer.image.tag: "${TAG}"

      t721app.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/t721app"
      t721app.image.tag: "${TAG}"

