settings:
  kubeContext: "${CONTEXT}"
  reverseDelete: true

helmRepos:
  stable: https://charts.helm.sh/stable
  common: https://charts.helm.sh/incubator
  incubator: https://charts.helm.sh/incubator
  jetstack: https://charts.jetstack.io

namespaces:
  staging:
  monitoring:
  default:

apps:

#   ██████  ███████ ███████  █████  ██    ██ ██   ████████ 
#   ██   ██ ██      ██      ██   ██ ██    ██ ██      ██    
#   ██   ██ █████   █████   ███████ ██    ██ ██      ██ 
#   ██   ██ ██      ██      ██   ██ ██    ██ ██      ██ 
#   ██████  ███████ ██      ██   ██  ██████  ███████ ██ 

  crds:
    timeout: 1200
    name: "crds"
    description: "CRDs, collection of custom ressource definitions to install globally"
    namespace: "default"
    enabled: true
    group: "critical"
    chart: "../@infra_crds/crds"
    version: "0.1.0"
    valuesFile: "../@infra_crds/crds/values.yaml"
    protected: false
    wait: true
    priority: -9
    setString:
      _global.namespace: "default"

  cert-manager:
    timeout: 1200
    name: "cert-manager"
    description: "Certifacte Manager, able to create valid certificates on-demand"
    namespace: "default"
    enabled: true
    group: "critical"
    chart: "../@infra_cert-manager/cert-manager"
    version: "0.1.0"
    valuesFile: "../@infra_cert-manager/cert-manager/values.yaml"
    protected: false
    wait: true
    priority: -8
    setString:
      _global.namespace: "default"
      route53.keySecret: "${CONFIG_STAGING_ROUTE53_SECRET}"

#   ███    ███  ██████  ███    ██ ██ ████████  ██████  ██████  ██ ███    ██  ██████ 
#   ████  ████ ██    ██ ████   ██ ██    ██    ██    ██ ██   ██ ██ ████   ██ ██      
#   ██ ████ ██ ██    ██ ██ ██  ██ ██    ██    ██    ██ ██████  ██ ██ ██  ██ ██   ███ 
#   ██  ██  ██ ██    ██ ██  ██ ██ ██    ██    ██    ██ ██   ██ ██ ██  ██ ██ ██    ██ 
#   ██      ██  ██████  ██   ████ ██    ██     ██████  ██   ██ ██ ██   ████  ██████  

  ingress-monitoring:
    timeout: 1200
    name: "ingress-monitoring"
    description: "Ingress, managing all incoming traffic and properly redirecting on services for the monitoring namespace"
    namespace: "monitoring"
    enabled: false
    group: "critical"
    chart: "../@infra_ingress/ingress"
    version: "0.1.0"
    valuesFile: "../@infra_ingress/ingress/values.yaml"
    protected: false
    wait: true
    priority: 0
    setString:
      _global.namespace: "monitoring"

      issuer.server: "${CONFIG_STAGING_ACME_SERVER}"

      baseDomain: "ticket721.com"
      domainExtension: "monitoring"

      hosts[0].name: "grafana.monitoring.ticket721.com"
      hosts[0].paths[0].route: "/"
      hosts[0].paths[0].serviceName: "prometheus-monitoring-grafana"
      hosts[0].paths[0].servicePort: "80"

      route53.keyId: "${CONFIG_STAGING_ROUTE53_KEY}"
      route53.hostedzone: "${CONFIG_STAGING_ROUTE53_HOSTEDZONE}"
      route53.region: "eu-west-3"

  prometheus-monitoring:
    timeout: 1200
    name: "prometheus-monitoring"
    description: "Prometheus gathers metrics about the cluster"
    namespace: "monitoring"
    enabled: false
    group: "critical"
    chart: "../@infra_prometheus/prometheus"
    version: "0.1.0"
    valuesFile: "../@infra_prometheus/prometheus/values.yaml"
    protected: false
    wait: true
    priority: -1
    setString:
      _global.namespace: "monitoring"

#   ███████ ████████  █████   ██████  ██ ███    ██  ██████ 
#   ██         ██    ██   ██ ██       ██ ████   ██ ██      
#   ███████    ██    ███████ ██   ███ ██ ██ ██  ██ ██   ███ 
#        ██    ██    ██   ██ ██    ██ ██ ██  ██ ██ ██    ██ 
#   ███████    ██    ██   ██  ██████  ██ ██   ████  ██████  

  ingress-staging:
    timeout: 1200
    name: "ingress-staging"
    description: "Ingress, managing all incoming traffic and properly redirecting on services for the staging namespace"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_ingress/ingress"
    version: "0.1.0"
    valuesFile: "../@infra_ingress/ingress/values.yaml"
    protected: false
    wait: true
    priority: 0
    setString:
      _global.namespace: "staging"

      issuer.server: "${CONFIG_STAGING_ACME_SERVER}"

      baseDomain: "ticket721.com"
      domainExtension: "staging"

      hosts[0].name: "api.staging.ticket721.com"
      hosts[0].paths[0].route: "/"
      hosts[0].paths[0].serviceName: "platform-staging--server--svc"
      hosts[0].paths[0].servicePort: "80"

      hosts[1].name: "organizer.staging.ticket721.com"
      hosts[1].paths[0].route: "/"
      hosts[1].paths[0].serviceName: "platform-staging--organizer--svc"
      hosts[1].paths[0].servicePort: "80"

      hosts[2].name: "app.staging.ticket721.com"
      hosts[2].paths[0].route: "/"
      hosts[2].paths[0].serviceName: "platform-staging--t721app--svc"
      hosts[2].paths[0].servicePort: "80"

      hosts[3].name: "staff.staging.ticket721.com"
      hosts[3].paths[0].route: "/"
      hosts[3].paths[0].serviceName: "platform-staging--staff--svc"
      hosts[3].paths[0].servicePort: "80"

      route53.keyId: "${CONFIG_STAGING_ROUTE53_KEY}"
      route53.hostedzone: "${CONFIG_STAGING_ROUTE53_HOSTEDZONE}"
      route53.region: "eu-west-3"

  efs-provisioner-staging:
    timeout: 1200
    name: "efs-provisioner-staging"
    description: "EFS Storage Provider, allowing pods to mount EFS volumes in the filesystem"
    namespace: "staging"
    enabled: false
    group: "critical"
    chart: "../@infra_efs-provisioner/efs-provisioner"
    version: "0.1.0"
    valuesFile: "../@infra_efs-provisioner/efs-provisioner/values.yaml"
    protected: false
    wait: true
    priority: -4
    setString:
      _global.namespace: "staging"
      "efs-provisioner.efsProvisioner.efsFileSystemId": "EFS_ID"
      "efs-provisioner.efsProvisioner.awsRegion": "eu-west-3"

  elassandra-staging:
    timeout: 1200
    name: "elassandra-staging"
    description: "Elassandra, storage layer of the infrastructure"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_elassandra/elassandra"
    version: "1.0.0"
    valuesFile: "../@infra_elassandra/elassandra/values.yaml"
    protected: false
    wait: true
    priority: -3
    setString:
      _global.namespace: "staging"

  redis-staging:
    timeout: 1200
    name: "redis-staging"
    description: "Redis, Storage layer for the distributed tasks"
    namespace: "staging"
    enabled: false
    group: "critical"
    chart: "../@infra_redis/redis"
    version: "0.1.0"
    valuesFile: "../@infra_redis/redis/values.yaml"
    protected: false
    wait: true
    priority: -2
    setString:
      _global.namespace: "staging"

  platform-staging:
    timeout: 2400
    name: "platform-staging"
    description: "The Ticket721 Platform"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_platform/platform"
    version: "0.1.0"
    valuesFile: "../@infra_platform/platform/values.yaml"
    protected: false
    wait: true
    priority: -1
    setString:
      _global.namespace: "staging"

      config.stripe.apiKey: "${CONFIG_STAGING_STRIPE_APIKEY}"

      config.cassandra.host: "elassandra-staging-cassandra"
      config.cassandra.port: "9042"

      config.redirections.emailValidationUrl: "https://organizer.staging.ticket721.com/validate-email"
      config.redirections.passwordResetUrl: "https://organizer.staging.ticket721.com/validate/password/reset"

      config.elasticsearch.host: "elassandra-staging-elasticsearch"
      config.elasticsearch.port: "9200"
      config.elasticsearch.protocol: "http"

      config.jwt.rounds: "9"
      config.jwt.secret: "${CONFIG_STAGING_JWT_SECRET}"
      config.jwt.expiration: "30d"

      config.mailjet.apiKey: "${CONFIG_STAGING_MAILJET_APIKEY}"
      config.mailjet.apiSecret: "${CONFIG_STAGING_MAILJET_APISECRET}"

      config.googleGeocodingApiKey: "${CONFIG_STAGING_GCLOUD_GEOLOC_APIKEY}"
      config.serverEndpoint.host: "api.staging.ticket721.com"
      config.serverEndpoint.port: "443"
      config.serverEndpoint.protocol: "https"

      config.t721app.segmentApiKey: "${CONFIG_STAGING_T721APP_SEGMENT_API_KEY}"
      config.t721app.publishableStripeApiKey: "${CONFIG_STAGING_T721APP_PUBLISHABLE_STRIPE_API_KEY}"
      config.t721app.itunesId: "${CONFIG_STAGING_T721APP_ITUNES_ID}"
      config.t721app.appStoreLink: "${CONFIG_STAGING_T721APP_APPSTORE_LINK}"
      config.t721app.playStoreLink: "${CONFIG_STAGING_T721APP_PLAYSTORE_LINK}"
      config.t721app.self: "https://app.staging.ticket721.com"
      config.t721app.iosMerchantId: "${CONFIG_STAGING_T721APP_APPLE_MERCHANT_ID}"

      config.staff.segmentApiKey: "${CONFIG_STAGING_STAFF_SEGMENT_API_KEY}"
      config.staff.organizerUrl: "https://organizer.staging.ticket721.com"
      config.staff.self: "https://staff.staging.ticket721.com"

      config.organizer.self: "https://organizer.staging.ticket721.com"
      config.organizer.publishableStripeApiKey: "${CONFIG_STAGING_ORGANIZER_PUBLISHABLE_STRIPE_API_KEY}"
      config.organizer.segmentApiKey: "${CONFIG_STAGING_ORGANIZER_SEGMENT_API_KEY}"

      config.bugReportLink: "${CONFIG_BUG_REPORT_LINK}"

      config.s3.region: "${CONFIG_STAGING_IMAGE_S3_REGION}"
      config.s3.accessKeyId: "${CONFIG_STAGING_IMAGE_S3_ACCESS_KEY_ID}"
      config.s3.secretAccessKey: "${CONFIG_STAGING_IMAGE_S3_SECRET_ACCESS_KEY}"
      config.s3.bucketName: "${CONFIG_STAGING_IMAGE_S3_BUCKET_NAME}"

      server.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/server"
      server.image.tag: "${TAG}"

      migrations.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/migrations"
      migrations.image.tag: "${TAG}"

      organizer.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/organizer"
      organizer.image.tag: "${TAG}"

      t721app.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/t721app"
      t721app.image.tag: "${TAG}"
      
      staff.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/staff"
      staff.image.tag: "${TAG}"

