settings:
  kubeContext: "${CONTEXT}"
  reverseDelete: true

namespaces:
  staging:

apps:
  cert-manager-staging:
    timeout: 1200
    name: "cert-manager"
    description: "Certifacte Manager, able to create valid certificates on-demand"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_cert-manager/cert-manager"
    version: "0.1.0"
    valuesFile: "../@infra_cert-manager/cert-manager/values.yaml"
    protected: false
    wait: true
    priority: -6
    setString:
      _global.namespace: "staging"

  efs-provisioner-staging:
    timeout: 1200
    name: "efs-provisioner"
    description: "EFS Storage Provider, allowing pods to mount EFS volumes in the filesystem"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_efs-provisioner/efs-provisioner"
    version: "0.1.0"
    valuesFile: "../@infra_efs-provisioner/efs-provisioner/values.yaml"
    protected: false
    wait: true
    priority: -5
    setString:
      _global.namespace: "staging"
      "efs-provisioner.efsProvisioner.efsFileSystemId": "${CONFIG_EFS_ID}"
      "efs-provisioner.efsProvisioner.awsRegion": "eu-west-3"

  elassandra-staging:
    timeout: 1200
    name: "elassandra"
    description: "Elassandra, storage layer of the infrastructure"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_elassandra/elassandra"
    version: "1.0.0"
    valuesFile: "../@infra_elassandra/elassandra/values.yaml"
    protected: false
    wait: true
    priority: -4
    setString:
      _global.namespace: "staging"

  redis-staging:
    timeout: 1200
    name: "redis"
    description: "Redis, Storage layer for the distributed tasks"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_redis/redis"
    version: "0.1.0"
    valuesFile: "../@infra_redis/redis/values.yaml"
    protected: false
    wait: true
    priority: -3
    setString:
      _global.namespace: "staging"

  platform-staging:
    timeout: 1200
    name: "platform"
    description: "The Ticket721 Platform"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_platform/platform"
    version: "0.1.0"
    valuesFile: "../@infra_platform/platform/values.yaml"
    protected: false
    wait: true
    priority: -2
    setString:
      _global.namespace: "staging"

      server.fsName: "${CONFIG_EFS_ID}"

      config.ticketScope: "ticket721_0"
      config.artifact: "live_ropsten"

      config.stripe.apiKey: "${CONFIG_STRIPE_APIKEY}"

      config.cassandra.host: "elassandra-cassandra"
      config.cassandra.port: "9042"

      config.redirections.emailValidationUrl: "http://localhost:3000/validate"
      config.redirections.passwordResetUrl: "http://localhost:3000/validate/password/reset"

      config.elasticsearch.host: "elassandra-elasticsearch"
      config.elasticsearch.port: "9200"
      config.elasticsearch.protocol: "http"

      config.ethereumNode.host: "api.rockside.io"
      config.ethereumNode.port: "443"
      config.ethereumNode.protocol: "https"
      config.ethereumNode.network_id: "3"
      config.ethereumNode.path: "/ethereum/ropsten/jsonrpc"
      config.ethereumNode.headers: '\{"apikey": "${CONFIG_ROCKSIDE_APIKEY}"\}'

      config.redis.host: "redis-master"
      config.redis.port: "6379"

      config.jwt.rounds: "9"
      config.jwt.secret: "${CONFIG_JWT_SECRET}"
      config.jwt.expiration: "12h"

      config.txs.blockThreshold: "2"
      config.txs.blockPollingRate: "1000"
      config.txs.targetGasPrice: "15"
      config.txs.gasLimit: "1000000"

      config.globalConfig.blockNumberFetchingRate: "1000"
      config.globalConfig.ethereumPriceFetchingRate: "1000"
      config.globalConfig.binanceMock: "false"

      config.bull.board: "true"

      config.mailjet.apiKey: "${CONFIG_MAILJET_APIKEY}"
      config.mailjet.apiSecret: "${CONFIG_MAILJET_APISECRET}"

      config.rockside.baseUrl: "https://api.rockside.io"
      config.rockside.apiKey: "${CONFIG_ROCKSIDE_APIKEY}"
      config.rockside.network_id: "3"
      config.rockside.network_name: "ropsten"

      server.image.repository: "ticket721/test-server"
      server.image.tag: "latest"

      worker.image.repository: "ticket721/test-worker"
      worker.image.tag: "latest"

      migrations.image.repository: "ticket721/test-migrations"
      migrations.image.tag: "latest"

  ingress-staging:
    timeout: 1200
    name: "ingress"
    description: "Ingress, managing all incoming traffic and properly redirecting on services"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_ingress/ingress"
    version: "0.1.0"
    valuesFile: "../@infra_ingress/ingress/values.yaml"
    protected: false
    wait: true
    priority: -1
    setString:
      _global.namespace: "staging"

      issuer.server: "https://acme-staging-v02.api.letsencrypt.org/directory"

      baseDomain: "ticket721.com"
      domainExtension: "staging"

      hosts[0].name: "api.staging.ticket721.com"
      hosts[0].paths[0].route: "/"
      hosts[0].paths[0].serviceName: "platform--server--svc"
      hosts[0].paths[0].servicePort: "80"

      route53.keyId: "${CONFIG_ROUTE53_KEY}"
      route53.keySecret: "${CONFIG_ROUTE53_SECRET}"
      route53.hostedzone: "${CONFIG_ROUTE53_HOSTEDZONE}"
      route53.region: "eu-west-3"


