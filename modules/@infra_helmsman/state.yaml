settings:
  kubeContext: "${CONTEXT}"
  reverseDelete: true

namespaces:
  staging:

apps:

#   ________  _________  ________  ________  ___  ________   ________
#  |\   ____\|\___   ___\\   __  \|\   ____\|\  \|\   ___  \|\   ____\
#  \ \  \___|\|___ \  \_\ \  \|\  \ \  \___|\ \  \ \  \\ \  \ \  \___|
#   \ \_____  \   \ \  \ \ \   __  \ \  \  __\ \  \ \  \\ \  \ \  \  ___
#    \|____|\  \   \ \  \ \ \  \ \  \ \  \|\  \ \  \ \  \\ \  \ \  \|\  \
#      ____\_\  \   \ \__\ \ \__\ \__\ \_______\ \__\ \__\\ \__\ \_______\
#     |\_________\   \|__|  \|__|\|__|\|_______|\|__|\|__| \|__|\|_______|
#     \|_________|

  cert-manager-staging:
    timeout: 1200
    name: "cert-manager"
    description: "Certifacte Manager, able to create valid certificates on-demand"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_cert-manager/cert-manager"
    version: "0.1.0"
    valuesFile: "../@infra_cert-manager/cert-manager/values.yaml"
    protected: true
    wait: true
    priority: -6
    setString:
      _global.namespace: "staging"

  efs-provisioner-staging:
    timeout: 1200
    name: "efs-provisioner"
    description: "EFS Storage Provider, allowing pods to mount EFS volumes in the filesystem"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_efs-provisioner/efs-provisioner"
    version: "0.1.0"
    valuesFile: "../@infra_efs-provisioner/efs-provisioner/values.yaml"
    protected: true
    wait: true
    priority: -5
    setString:
      _global.namespace: "staging"
      "efs-provisioner.efsProvisioner.efsFileSystemId": "${CONFIG_STAGING_EFS_ID}"
      "efs-provisioner.efsProvisioner.awsRegion": "eu-west-3"

  elassandra-staging:
    timeout: 1200
    name: "elassandra"
    description: "Elassandra, storage layer of the infrastructure"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_elassandra/elassandra"
    version: "1.0.0"
    valuesFile: "../@infra_elassandra/elassandra/values.yaml"
    protected: true
    wait: true
    priority: -4
    setString:
      _global.namespace: "staging"

  redis-staging:
    timeout: 1200
    name: "redis"
    description: "Redis, Storage layer for the distributed tasks"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_redis/redis"
    version: "0.1.0"
    valuesFile: "../@infra_redis/redis/values.yaml"
    protected: true
    wait: true
    priority: -3
    setString:
      _global.namespace: "staging"

  platform-staging:
    timeout: 1200
    name: "platform"
    description: "The Ticket721 Platform"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_platform/platform"
    version: "0.1.0"
    valuesFile: "../@infra_platform/platform/values.yaml"
    protected: false
    wait: true
    priority: -2
    setString:
      _global.namespace: "staging"

      server.fsName: "${CONFIG_STAGING_EFS_ID}"

      config.ticketScope: "ticket721_0"
      config.artifact: "live_ropsten"

      config.stripe.apiKey: "${CONFIG_STAGING_STRIPE_APIKEY}"

      config.cassandra.host: "elassandra-cassandra"
      config.cassandra.port: "9042"

      config.redirections.emailValidationUrl: "http://localhost:3000/validate"
      config.redirections.passwordResetUrl: "http://localhost:3000/validate/password/reset"

      config.elasticsearch.host: "elassandra-elasticsearch"
      config.elasticsearch.port: "9200"
      config.elasticsearch.protocol: "http"

      config.ethereumNode.host: "api.rockside.io"
      config.ethereumNode.port: "443"
      config.ethereumNode.protocol: "https"
      config.ethereumNode.network_id: "3"
      config.ethereumNode.path: "/ethereum/ropsten/jsonrpc"
      config.ethereumNode.headers: '\{"apikey": "${CONFIG_STAGING_ROCKSIDE_APIKEY}"\}'

      config.redis.host: "redis-master"
      config.redis.port: "6379"

      config.jwt.rounds: "9"
      config.jwt.secret: "${CONFIG_STAGING_JWT_SECRET}"
      config.jwt.expiration: "12h"

      config.txs.blockThreshold: "2"
      config.txs.blockPollingRate: "1000"
      config.txs.targetGasPrice: "15"
      config.txs.gasLimit: "1000000"

      config.globalConfig.blockNumberFetchingRate: "1000"
      config.globalConfig.ethereumPriceFetchingRate: "1000"
      config.globalConfig.binanceMock: "false"

      config.bull.board: "true"

      config.mailjet.apiKey: "${CONFIG_STAGING_MAILJET_APIKEY}"
      config.mailjet.apiSecret: "${CONFIG_STAGING_MAILJET_APISECRET}"

      config.rockside.baseUrl: "https://api.rockside.io"
      config.rockside.apiKey: "${CONFIG_STAGING_ROCKSIDE_APIKEY}"
      config.rockside.network_id: "3"
      config.rockside.network_name: "ropsten"

      server.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/server"
      server.image.tag: "${TAG}"

      worker.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/worker"
      worker.image.tag: "latest"

      migrations.image.repository: "097558125954.dkr.ecr.eu-west-3.amazonaws.com/ticket721/migrations"
      migrations.image.tag: "latest"

  ingress-staging:
    timeout: 1200
    name: "ingress"
    description: "Ingress, managing all incoming traffic and properly redirecting on services"
    namespace: "staging"
    enabled: true
    group: "critical"
    chart: "../@infra_ingress/ingress"
    version: "0.1.0"
    valuesFile: "../@infra_ingress/ingress/values.yaml"
    protected: false
    wait: true
    priority: -1
    setString:
      _global.namespace: "staging"

      issuer.server: "${CONFIG_STAGING_ACME_SERVER}"

      baseDomain: "ticket721.com"
      domainExtension: "staging"

      hosts[0].name: "api.staging.ticket721.com"
      hosts[0].paths[0].route: "/"
      hosts[0].paths[0].serviceName: "platform--server--svc"
      hosts[0].paths[0].servicePort: "80"

      route53.keyId: "${CONFIG_STAGING_ROUTE53_KEY}"
      route53.keySecret: "${CONFIG_STAGING_ROUTE53_SECRET}"
      route53.hostedzone: "${CONFIG_STAGING_ROUTE53_HOSTEDZONE}"
      route53.region: "eu-west-3"


